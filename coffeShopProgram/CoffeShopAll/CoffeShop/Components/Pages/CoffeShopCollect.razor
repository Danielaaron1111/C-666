@page "/coffeshopcollect"
<PageTitle>CoffeshopCollect</PageTitle>
@rendermode InteractiveServer
@using CoffeeShopSystem
<h3>CoffeshopCollect</h3>



@if (errorMsgs.Count > 0)
{
    <div class="row alert alert-danger">
        <p><strong>Please fix the following issues:</strong></p>
        <ul>
            @foreach (var error in errorMsgs)
            {
                <!--
                errors are stored in a dictionary so each one has a unique key
                i only display the message part (the Value)
                -->
                <li>@error.Value</li>
            }
        </ul>
    </div>
}
<style>


    legend {
        text-align: center;
    }
</style>
<fieldset>
    <legend>Coffee Shop Order Form</legend>
    <h4>Order details</h4>
    <!-- ORDER ID SECTION TEXT INPUT  -->
    <div class="row">
        <div class="offset-3 col-md-2">
            <label for="orderid">Order ID: </label>
        </div>
        <div class="col-md-3">
            <input type="text"
                   id="orderid"
                   placeholder="123123"
                   @bind="orderId" />
        </div>
    </div>
    <br />
    <!-- description input -->
    <div class="row">
        <div class="offset-3 col-md-2">
            <label for="description">Customer ID:</label>
        </div>
        <div class="col-md-3">
            <input type="text"
                   id="customerName"
                   placeholder="customer name"
                   @bind="customerName" />
        </div>
    </div>

    <!-- Coffe Size section-->
    <div class="row">
        <div class="col-md-4">
            <label for="openingtype">Coffe Size</label>
        </div>
        <div class="col-md-4">
            <!-- i use a dropdown so users can only pick from valid options
            this keeps bad data from being entered
            -->
            <select id="coffesize" @bind="coffesize">
                <option> Select Size</option>
                <!--
                i loop through the OpeningType enum and display each option
                the user picks one and i get that value back
                -->
                @foreach (var item in Enum.GetValues(typeof(CoffeeSize)))
                {
                    <!-- each enum becomes an option in the dropdown -->
                    <option value="@item">@item</option>
                }
            </select>
        </div>
    </div>
    <br />

    <!-- Coffe type section-->
    <div class="row">
        <div class="col-md-4">
            <label for="openingtype">Coffe Type</label>
        </div>
        <div class="col-md-4">
            <!-- i use a dropdown so users can only pick from valid options
            this keeps bad data from being entered
            -->
            <select id="coffetype" @bind="coffetype">
                <option> Select Type</option>
                <!--
                i loop through the coffeType enum and display each option
                the user picks one and i get that value back
                -->
                @foreach (var item in Enum.GetValues(typeof(CoffeeType)))
                {
                    <!-- each enum becomes an option in the dropdown -->
                    <option value="@item">@item</option>
                }
            </select>
        </div>
    </div>
    <br />

    <!-- coffe quantity  -->
    <div class="row">
        <div class="col-md-4">
            <label for="openingheight">Quantity:</label>
        </div>
        <div class="col-md-4">
            <!-- something here -->
            <input type="number"
                   id="quantity"
                   style="width: 100px;"
                   @bind="quantity" />

        </div>
    </div>


    <br />

    <!--  coffe Price -->
    <div class="row">
        <div class="col-md-4">
            <label for="openingheight">Price:</label>
        </div>
        <div class="col-md-4">
            <!-- something here -->
            <input type="number"
                   id="price"
                   style="width: 100px;"
                   @bind="price" />

        </div>
    </div>


    <br />

    <!-- buttons at the bottom -->
    <div class="row">
        <div class="col-md-12 text-center">
            <!-- record button saves the data -->
            <button type="button" class="btn btn-primary"
                    @onclick="OnRecord">
                Record
            </button>
            &nbsp;&nbsp;
            <!-- clear button resets the form -->
            <button type="button" class="btn btn-secondary"
                    @onclick="OnClear">
                Clear
            </button>
            &nbsp;&nbsp;
            <!-- report button takes you to the report page -->
            <button type="button" class="btn btn-success"
                    @onclick="OnReport">
                Report
            </button>
        </div>
    </div>


</fieldset>





@code {
    private Dictionary<int, string> errorMsgs = new();


    //variables to hold form data

    private string orderId = "";
    private string customerName = "";
    // private CoffeeType coffetype = CoffeeType.Espresso;
    // private CoffeeSize coffesize = CoffeeSize.Small;
    private CoffeeType? coffetype = null;
    private CoffeeSize? coffesize = null;
    private int quantity = 0;
    private double price = 0;


    [Inject] //ask don
    private IWebHostEnvironment webHostEnvironment { get; set; }

    [Inject] // ask don
    private NavigationManager NavigationManager { get; set; }

    protected void OnRecord()
    {
        errorMsgs.Clear();

        //validation checks

        if (string.IsNullOrEmpty(orderId))
        {
            errorMsgs.Add(1, "Order ID is required.");
        }
        if (string.IsNullOrEmpty(customerName))
        {
            errorMsgs.Add(2, "Customer Name is required.");
        }
        if (!coffetype.HasValue)
        {
            errorMsgs.Add(5, "Coffee Type is required.");
        }
        if (!coffesize.HasValue)
        {
            errorMsgs.Add(6, "Coffee Size is required.");
        }
        if (quantity < 1 || quantity > 20)
        {
            errorMsgs.Add(7, "Quantity must be between 1 and 20.");
        }
        if (price < 0.01 || price > 100.00)
        {
            errorMsgs.Add(8, "Price must be between .01 and $100.00.");
        }
        //if no errors, save the data
        if (errorMsgs.Count == 0)
        {
            try
            {
                //save the data here

                CoffeeOrder order = new CoffeeOrder(
                        orderId,
                        customerName,
                        coffetype.Value,
                        coffesize.Value,
                        quantity,
                        price
                    );
                string csvFilePathName = $@"{webHostEnvironment.ContentRootPath}/Components/Data/GoodTestFile.csv";
                //PUT THE FUCKINGH NAME OF YOUR OBJECT IN THE TOSTRING MADAFGAKERRRRRRRRRR
                
                string line = $"{order.ToString()}\n";
                // this method creates the file if it doesnt exist, opens it, writes, and closes it
                System.IO.File.AppendAllText(csvFilePathName, line);
                OnClear(); //clear the form after saving
                //sending the user to the report Coffe page:
                NavigationManager.NavigateTo("/coffeshopreportrazor");



            }
            catch (ArgumentNullException ex)
            {
                //10  this happens if required fields are missing
                errorMsgs.Add(9, $"Data Missing Error: {ex.Message}");
            }
            catch (ArgumentException ex)
            {
                //11 this happens if validation fails, like walls too small or bad opening sizes
                errorMsgs.Add(10, $"Bad Data Error: {ex.Message}");
            }
            catch (Exception ex)
            {
                //12 catching any other unexpected errors
                errorMsgs.Add(11, $"System Error: {ex.Message}");
            }

        }
    }
    //2 Customer Name: cannot be empty
    //3 Quantity: must be positive, between 1-20
    //4 Price: must be between .01 and $100.00

    protected void OnClear()
    {
        //reset all form fields to default values
        orderId = "";
        customerName = "";
        coffetype = null;
        coffesize = null;
        quantity = 0;
        price = 0;
        errorMsgs.Clear();
    }

    protected override void OnInitialized()
    {
        base.OnInitialized();


    }
    protected void OnReport()
    {
        NavigationManager.NavigateTo("/coffeshopreportrazor");
    }
}


