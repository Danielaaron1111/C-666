================================================================================
RENO ASSIGNMENT - CURRENT STATE
Exercise 4 - Database Querying Based on Filters
================================================================================
Date Generated: 2025-11-16
Repository: C:\GitHub\1517-sep-2025-A02-exercise4-Danielaaron1111
================================================================================

[TABLE OF CONTENTS]
1. Assignment README
2. Web Application Files (RenoTracker)
   - Program.cs
   - appsettings.json
   - Components\Layout\NavMenu.razor
   - Components\Pages\Home.razor
   - Components\Pages\Weather.razor
3. Class Library Files (RenoSystem)
   - RenoSystemExtensions.cs
   - BLL\JobServices.cs
   - BLL\SupplyServices.cs
   - DAL\RenosContext.cs
   - ENTITIES\Client.cs
   - ENTITIES\Job.cs
   - ENTITIES\Supply.cs
   - ENTITIES\Labour.cs
   - ENTITIES\DbVersion.cs
4. Summary of Current State

================================================================================
ASSIGNMENT README
================================================================================
# Book Reviews - Ex04 - Database Querying Based on Filters

> This is the next in a series of exercises where you will be creating a website to query information on renovations demonstrating Client/Server techniques using data from a database.
> **RenoTracker** is a web application for those who want to keep information on home renovation jobs within their business. To start application development, we will limit the data to maintain in a database to client, job, material and labour.
>
## Objectives

This exercise will allow you to demonstrate:

- your understanding of basic Client-Server architecture
- your ability to create a Client-Server solution consisting of a web application and application class library
- set up your application class library to interact with a database using EntityFramework with entities created by Reverse Engineering
- create a series of server services to return data from the class library to your web page
- implement a tabular report from a collection of data supplied by a service call to your class library
- demonstrate your understanding of filter searches to obtain data from a database using appropriate Linq queries

## Overview

You are to create a Client Server solution containing a Blazor .Net 9.0 web application and an application library (.Net 9.0 class library).

Use the following names:

- Solution: `RenoDBSolution`
- Web Application: `RenoTracker`
- Application Library: `RenoSystem`.

A key aspect of the site is to allow users to search the database to find supply information on various jobs by job id. Your task in this assignment is to provide that functionality. You will configure your web application to use the class library via property injection. You will create a new page that will display a tabular report using data returned from a class library service.

Use the demos presented in class as a guide to implementing this exercise.

### Database setup

Use the supplied database found in this repository: `Renos.bacpac` has been supplied to you for this exercise. Restore this database to your machine. Use Microsoft SQL Management Studio (use Import Data-tier Application) to restore the `Renos.bacpac` file as the exercise database. **The database is to be named `Renos`.**

### Client Service Web Application

1. Create a .Net Core 9 Blazor web server application project called `RenoTracker`. **Turn off the Configure for HTTPS check box.** This project will reference your class library. Include the sample pages. You may use images from Exercise 3.

2. Create a .Net Core 9 class library project called `RenoSystem`. Your web project will reference this project. Add 3 folders to your class library project: BLL, DAL and Entities (your instructor may have named this folder Models).

*Remember that Github does not track empty folders, so you might wish to add a dummy.txt file in each folder
 if you intend to commit and push at this time. You may remove these dummy files as you add other files to the folder.*

### Client Service Application class library using a database

### A) Create and Verify Entities

You will use reverse engineering, via EF Core Power Tools, to create your entity classes that map to the database. Add the necessary NuGet packages to handle data from a MS SQL database if they are not added during the reverse engineering: Microsoft.EntityFrameworkCore(9.0.1) and Microsoft.EntityFrameworkCore.SqlServer(9.0.1)

- Your EF Core verion should be EF Core 9.
- Select all tables (only the tables).
- Take the default Context name and namespace.
- Turn on Pluralize or singularize; Use table and column names; Use DataAnnotation; and Install the EF Core options.
- Place the entity classes in your Entities folder and the context class in your DAL folder.
- Alter the context class access level to **internal**.

![ERD](./ERD_Renos.png)

### B) Verify DAL Context

In the "DAL" folder, a file called `RenosContext.cs` was created which will contain the `RenosContext` class.

- Ensure it inherits from `DbContext`.
- Your class should have a constructor for DbContextOptions<> options injection.
- Change the access level of the context class to **internal**.

*Your DbSet properties for your entity classes should also be present.*

### C) Extension class creation

This class will contain the dbcontext and transient registerations that will be available for  injection in your web application.

The class method will be called within the web application `Program.cs` file.

- Create a class called `RenoSystemExtensions` at the root of the application library. Change the class to be public static.
- Add the static method `RenoSystemExtensionServices`. Check you class demo for appropriate parameters.
- Within the method, you will register your DbContext and the AddTransient factory for your BLL service classes.

As you code, you will need to resolve references to needed namespaces holding your context class and service classes.

### D) BLL Services

You will need to create each of the services below.

- Each service class will need an appropriate internal constructor that requires an instance of the `RenosContext` as a parameter.
- Save the parameter value into a private readonly variable. As you code, you will need to resolve references to needed namespaces holding your context class and entity class.
- Once you have created the class, register the class in your extension method via AddTransient.
- **If a method has a string parameter, ensure one was passed and, if not, throw an `ArgumentNullException`.**

**JobServices class**

Create a new service class called `JobServices` in your BLL folder. This class will contain one service method to return the complete list of Jobs. This query list will be sorted alphabetically by Description.  Remember to register your service class.

In this class, create a public method called `Job_GetList()` that:

- Has no parameters
- You will need to include the associated Client instance for each job.
- Returns an ordered collection (by Description) of all records of the Job entity.

**SupplyServices**

Create a new service class called `SupplyServices` in your BLL folder. This class will contain two service methods:  to return the page list of supplies for a specified job ordered by Material and another to return the total number of materails for a specified job. Each method will receive a filtering parameter for a specified job. One method will also receive the data necessary to implement paging and return only the records needed for the current page that will be displayed. Remember to register your service class.

Create a public method called `GetByJobId(int, int, int)` that:

- Has one parameter for the data and 2 parameters to handle paging
- Returns a collection of Supply records, ordered alphabetically by Material, where the JobId equals the parameter value for the current page to be displayed.
- The data parameter value will be an integer job id value.

Create a public method called `GetJobSupplyCount(int)` that:

- Has one parameter for the data
- Returns the total count of records where the JobId equals the parameter.

After creating these classes, rebuild your Application Class Library. You should get a successful build.

### Overview Web Application Functionality and Requirements

### A) Create your database connection string in the appsettings.json file

```csharp
"ConnectionStrings": {
    "RenoDB" : "Server=xxxx;Database=Renos;Trusted_Connection=true;MultipleActiveResultSets=true"
  }
```

Replace the "Server=xxxx" in the above with your server name as demonstrated in class.

### B) Setup the service dependency registration for the web application

This will be done within your `Program.cs` file. Use your class lesson demonstration to complete this process.
You will need to add a project reference to the web application pointing to the class libray.

### C) Home Page

Change the home page to include your name, known bugs and last date modified. If you are using images that are not sourced by you, add a Credits and attributions note. Format design is up to you.

![home](./sample_home_page.png)

### D) Overview Query Page

### Query Page to search Supplies needed for a specific Job

- Create a `Query.razor` web page component.
- Use project property injection for the `JobServices` and `SupplyServices` classes.
- Be sure to add a nav item so that this page can be navigated to using the nav menu. Use the text "Query" for the link.
- Add an appropriate title to the page and the title browser tab.

Details of your display can be found below:

The `Query` page will display summary information on the Renos data in an HTML table with headings:

- `Material`
- `Quantity`
- `Material Cost`

#### Requirements

- This query page will have Drop Down List filter showing the job description and start date. Use the following text display format:  Bedroom (May 23, 2025) - Contact  where Contact is the Client Contact.
- Search button will execute an event handler to retrieve the Supply data using the search Job ID value.
- Clear button will execute an event handler to reset the page to its opening state.
- Demonstrate paging by limiting your display to 10 lines at a time.
- Display a message if no supplies have been found for the selected job.

*Reminder: Add the NuGet package Blazor.Bootstrap to your web application project.*

### Samples

Only present the data fields as shown below:

![query supply](./querydisplay.png)

![query supply error](./nojobselection.png)

To ensure that your web application works, build and run your project.

## Submission

Commit your work in your **exercise** repository and sync to github.com.

## Evaluation

> ***NOTE:** Your code **must** compile. Solutions that do not compile will receive an automatic mark of zero (0).*
>
> If you are unable to get a portion of the assignment to compile, you should:
>
> - Comment out the non-compiling portion of code
> - Identify the non-compiling portion with a **Incomplete Requirements** heading, noting the item's
>

Your assignment will be marked based upon the following weights.

|  Weight | Deliverable/Requirement |
|  ---- | --------- |
|  **1** | Create appropriate ASP.NET Core Class Blazor web server application (.net core 8) |
|  **1** | Create appropriate ASP.NET Core Class Library (.net core 8) |
|  **1** | Uses reverse engineering to create Entities with custom validation message and DAL classes |
|  **2** | Setup project references, necessary NuGet packages, and service registration using extension class |
|  **2** | `JobServices.cs` BLL service class|
|  **2** | `SupplyServices.cs` BLL service class |
|  **3** | `Query.razor` setup appropriate controls for query argument (job id) and table display (Supplies) |
|  **3** | `Query.razor` Query Entry page (web page event processing including appropriate error handling). |
|  **1** | `Query.razor` Clear page (button/event) |
|  **2** | Git Workflow Evidence (early start, incremental development) |
|  **2** | Code Quality & Readability |
| ---- | --------- |

----

| Weight | Breakdown |
| ----- | --------- |
| **1** | 1 = Proficient (requirements are met; meets all class standards; contains acceptable coding structures)<br />0 = Incomplete (requirements not met; missing large portions/requirements; major errors; class standards not meet; contains unacceptable coding structures) |
| **2** | 2 = Proficient (requirements are met; meets all class standards; contains acceptable coding structures)<br />1 = Limited (requirements adequately met; missing some minor portions; minor errors, class standards not meet; contains unacceptable coding structures)<br />0 = Incomplete (requirements not met or missing large portions; major errors; class standards not followed; contains unacceptable coding structures) |
| **3** | 3 = Proficient (requirements are met; meets all class standards, contains acceptable coding structures)<br />2 = Capable (requirements are adequately met; minor errors; class standards not meet; contains unacceptable coding structures)<br />1 = Limited (requirements are partially met; major errors; class standards not meet; contains unacceptable coding structures)<br />0 = Incomplete (requirements not met or missing large portions; major errors; class standards not meet; contains unacceptable coding structures) |

----

[Return to exercises](../README.md)


================================================================================
FILE: RenoTracker\Program.cs
================================================================================
using RenoTracker.Components;
using Microsoft.EntityFrameworkCore;
using RenoSystem.ENTITIES;


var builder = WebApplication.CreateBuilder(args);

//retrieve the connection string from the appsetting.json
//the connection string will be passed to the class library using
//  the encapsulated extension method
//the connection string will be registered to get access to the database
string connectionstring = builder.Configuration.GetConnectionString("RenosDB");

//get access to any extended services
//gain access to any available services that have been registered in IServiceCollections
//the technique used in this example has the registrations encapsulated
//  within the class library via an extension method
//technically, you could put all the setup that is in the extension method
//  here in this file
builder.Services.AddDbContext<DbVersion>(options => options.UseSqlServer(connectionstring));

// Add services to the container
builder.Services.AddRazorComponents();

var app = builder.Build();

// Configure the HTTP request pipeline.
if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error", createScopeForErrors: true);
}


app.UseAntiforgery();

app.MapStaticAssets();
app.MapRazorComponents<App>();

app.Run();


================================================================================
FILE: RenoTracker\appsettings.json
================================================================================
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",

  //this setting variable will indicate the connection string for the
  //  application
  //the string needs the following:
  //  server name
  //  database name
  //  any other additional connection option
  //NOTE: you may run into an encryption problem or trusted certificate problem
  //Solution: for the encryption problem, add the parameter encrypt=false
  //          for the certificate problem, add the parameter TrustServerCertificate=false
  "ConnectionStrings": {
    "RenoDB": "Server=.;Database=Renos;Trusted_Connection=true;MultipleActiveResultSets=true;encrypt=false"
  },

  //reference from the demo if i have to come back:

  //"ConnectionStrings": {
  //  "WWDB": "Server=.;Database=WestWind;Trusted_Connection=true;MultipleActiveResultSets=true;encrypt=false"
  //}
}


================================================================================
FILE: RenoTracker\Components\Layout\NavMenu.razor
================================================================================
<div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="">RenoTracker</a>
    </div>
</div>

<input type="checkbox" title="Navigation menu" class="navbar-toggler" />

<div class="nav-scrollable" onclick="document.querySelector('.navbar-toggler').click()">
    <nav class="nav flex-column">
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                <span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> Home
            </NavLink>
        </div>

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="weather">
                <span class="bi bi-list-nested-nav-menu" aria-hidden="true"></span> Weather
            </NavLink>
        </div>
    </nav>
</div>


================================================================================
FILE: RenoTracker\Components\Pages\Home.razor
================================================================================
@page "/"

<PageTitle>Home</PageTitle>

<h1>Hello, world!</h1>

Welcome to your new app.


================================================================================
FILE: RenoTracker\Components\Pages\Weather.razor
================================================================================
@page "/weather"
@attribute [StreamRendering]

<PageTitle>Weather</PageTitle>

<h1>Weather</h1>

<p>This component demonstrates showing data.</p>

@if (forecasts == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>Date</th>
                <th aria-label="Temperature in Celsius">Temp. (C)</th>
                <th aria-label="Temperature in Farenheit">Temp. (F)</th>
                <th>Summary</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var forecast in forecasts)
            {
                <tr>
                    <td>@forecast.Date.ToShortDateString()</td>
                    <td>@forecast.TemperatureC</td>
                    <td>@forecast.TemperatureF</td>
                    <td>@forecast.Summary</td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    private WeatherForecast[]? forecasts;

    protected override async Task OnInitializedAsync()
    {
        // Simulate asynchronous loading to demonstrate streaming rendering
        await Task.Delay(500);

        var startDate = DateOnly.FromDateTime(DateTime.Now);
        var summaries = new[] { "Freezing", "Bracing", "Chilly", "Cool", "Mild", "Warm", "Balmy", "Hot", "Sweltering", "Scorching" };
        forecasts = Enumerable.Range(1, 5).Select(index => new WeatherForecast
        {
            Date = startDate.AddDays(index),
            TemperatureC = Random.Shared.Next(-20, 55),
            Summary = summaries[Random.Shared.Next(summaries.Length)]
        }).ToArray();
    }

    private class WeatherForecast
    {
        public DateOnly Date { get; set; }
        public int TemperatureC { get; set; }
        public string? Summary { get; set; }
        public int TemperatureF => 32 + (int)(TemperatureC / 0.5556);
    }
}


================================================================================
FILE: RenoSystem\RenoSystemExtensions.cs
================================================================================
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.DependencyInjection;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

#region Additional Namespaces
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.DependencyInjection;
using RenoSystem.BLL;

using RenoSystem.ENTITIES;
#endregion

namespace RenoSystem
{
    public static class RenoSystemExtensionsServices
    {
        //this class can hold an set of extension methods
        //this sample creates an extension method that will add services
        //  to IServiceCollection
        //this method will be called from an separate project to
        //  gain data from the RENOS database
        //In this demo, the call will be done in the RenoSystem Program.cs file
        //this method will do 2 things:
        //  a) register the context connection string
        //  b) register ALL services that I create within the BLL class(es)
        public static void RenosSystemExtensionServices(this IServiceCollection services,
                Action<DbContextOptionsBuilder> options)
        {
            //handle the connection string
            //add my context class to the services (IServiceCollection)
            //we wish it to use the string I send in on each creation of the
            //      instance of my DbContext class
            services.AddDbContext<RenosContext>(options);

            //to register a service class you will use the IServiceCollection method
            //  .AddTransient<T> where T is the service class name
            //for any outside user coding that requires access to one or more services
            //  you MUST register the service class, hence all public methods within the class
            //  will be available

            services.AddTransient<JobServices>((serviceProvider) =>
            {
                var context = serviceProvider.GetService<RenosContext>();
                return new JobServices(context);
            });
            services.AddTransient<SupplyServices>((serviceProvider) =>
            {
                var context = serviceProvider.GetService<RenosContext>();
                return new SupplyServices(context);
            });

            //services.AddTransient<RegionServices>((serviceProvider) =>
            //{
            //    var context = serviceProvider.GetService<RenosContext>();
            //    return new RegionServices(context);
            //});

        }
    }
}


================================================================================
FILE: RenoSystem\BLL\JobServices.cs
================================================================================
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore;
using Microsoft.Win32;
using RenoSystem.BLL;



#region Additional Namespaces

using RenoSystem.ENTITIES;// for job entity
#endregion

namespace RenoSystem.BLL
{
    public class JobServices // must be public to blazor use it this!!!!!!!
    {
        //dabase conextion variable (provided by dependemcy injection no ready yet)
        private readonly RenosContext _context; //THIS STORE MY DATABASE CONNECTION FOR THAT REASON IS PRIVATE

        //constructor to receieve
        internal JobServices(RenosContext context) // IS INTERNATL because contains the context
        {
            _context = context; // also this constructor will create
        }

        // method to return all jobs
        public IEnumerable<Job> Job_GetList() //return a list of job objects
        {
            return _context.Jobs
                .Include(j => j.Client) //give me the jobs from the DB
                .OrderBy(j => j.Description) // load client data
                .ToList(); // conver all in a list
        }






    }
}
//D) BLL Services

//You will need to create each of the services below.

//- Each service class will need an appropriate internal constructor that requires an instance of the `RenosContext` as a parameter.
//- Save the parameter value into a private readonly variable.As you code, you will need to resolve references to needed namespaces holding your context class and entity class.
//-Once you have created the class, register the class in your extension method via AddTransient.
//- **If a method has a string parameter, ensure one was passed and, if not, throw an `ArgumentNullException`.**

//**JobServices class**

//Create a new service class called `JobServices` in your BLL folder. This class will contain one service method to return the complete list of Jobs. This query list will be sorted alphabetically by Description.  Remember to register your service class.

//In this class, create a public method called `Job_GetList()` that:

//-Has no parameters
//- You will need to include the associated Client instance for each job.
//- Returns an ordered collection (by Description) of all records of the Job entity.

//**SupplyServices**

//Create a new service class called `SupplyServices` in your BLL folder. This class will contain two service methods:  to return the page list of supplies for a specified job ordered by Material and another to return the total number of materails for a specified job. Each method will receive a filtering parameter for a specified job. One method will also receive the data necessary to implement paging and return only the records needed for the current page that will be displayed. Remember to register your service class.

//Create a public method called `GetByJobId(int, int, int)` that:

//-Has one parameter for the data and 2 parameters to handle paging
//- Returns a collection of Supply records, ordered alphabetically by Material, where the JobId equals the parameter value for the current page to be displayed.
//- The data parameter value will be an integer job id value.

//Create a public method called `GetJobSupplyCount(int)` that:

//-Has one parameter for the data
//- Returns the total count of records where the JobId equals the parameter.

//After creating these classes, rebuild your Application Class Library. You should get a successful build. parameter, ensure one was passed and, if not, throw an `ArgumentNullException`.**


================================================================================
FILE: RenoSystem\BLL\SupplyServices.cs
================================================================================
using RenoSystem.BLL;
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using RenoSystem.ENTITIES;

namespace RenoSystem.BLL
{
    public  class SupplyServices
    {

        //again database connection variable got it by dependency injection
        //( i must repeat this many times )
        private readonly RenosContext _context;


        //constructor to receive the context connection
        internal SupplyServices(RenosContext context)
        {
            _context = context;
        }
        public List<Supply> GetByJobId(int jobId, int pageNumber, int pageSize)
        {
            // Validation (WestWind pattern)
            if (jobId <= 0)
            {
                throw new ArgumentException($"Job ID {jobId} is invalid. Must be greater than 0.");
            }
            int skip = (pageNumber - 1) * pageSize; //formula

            // Query (PURE WestWind pattern - lines 72-77)
            IEnumerable<Supply> info = _context.Supplies
                                                .Where(x => x.JobId == jobId)
                                                .OrderBy(x => x.Material)
                                                .Skip(skip)
                                                .Take(pageSize);

            return info.ToList();
        }
        public int GetJobSupplyCount(int jobId)
        {
            return _context.Supplies
                           .Where(x => x.JobId == jobId)
                           .Count();
        }


    }
}


//**SupplyServices * *

//Create a new service class called `SupplyServices`
//in your BLL folder. This class will contain two service methods:
//to return the page list of supplies for a specified job ordered by Material
//and another to return the total number of materails for a specified job.
//Each method will receive a filtering parameter for a specified job.
//One method will also receive the data necessary to implement paging and
//return only the records needed for the current page that will be displayed.
//Remember to register your service class.

//Create a public method called `GetByJobId(int, int, int)` that:

//-Has one parameter for the data and 2 parameters to handle paging
//- Returns a collection of Supply records, ordered alphabetically by Material, where the JobId equals the parameter value for the current page to be displayed.
//- The data parameter value will be an integer job id value.

//Create a public method called `GetJobSupplyCount(int)` that:

//-Has one parameter for the data
//- Returns the total count of records where the JobId equals the parameter.

//After creating these classes, rebuild your Application Class Library. You should get a successful build.


================================================================================
FILE: RenoSystem\DAL\RenosContext.cs
================================================================================
// <auto-generated> This file has been auto generated by EF Core Power Tools. </auto-generated>
#nullable disable
using System;
using System.Collections.Generic;
using Microsoft.EntityFrameworkCore;

namespace RenoSystem.ENTITIES;


internal partial class RenosContext : DbContext
{
    public RenosContext(DbContextOptions<RenosContext> options)
        : base(options)
    {
    }

    public virtual DbSet<Client> Clients { get; set; }

    public virtual DbSet<DbVersion> DbVersions { get; set; }

    public virtual DbSet<Job> Jobs { get; set; }

    public virtual DbSet<Labour> Labours { get; set; }

    public virtual DbSet<Supply> Supplies { get; set; }

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        modelBuilder.Entity<Client>(entity =>
        {
            entity.HasKey(e => e.ClientId).HasName("PK_Clients_ClientId");

            entity.Property(e => e.Phone).IsFixedLength();
            entity.Property(e => e.PostalCode).IsFixedLength();
            entity.Property(e => e.Province).IsFixedLength();
        });

        modelBuilder.Entity<DbVersion>(entity =>
        {
            entity.HasKey(e => e.Id).HasName("PK_DbVersion_Id");
        });

        modelBuilder.Entity<Job>(entity =>
        {
            entity.HasKey(e => e.JobId).HasName("PK_Jobs_JobId");

            entity.HasOne(d => d.Client).WithMany(p => p.Jobs)
                .OnDelete(DeleteBehavior.ClientSetNull)
                .HasConstraintName("FK_JobsClients_ClientId");
        });

        modelBuilder.Entity<Labour>(entity =>
        {
            entity.HasKey(e => e.LabourId).HasName("PK_Labours_LabourId");

            entity.HasOne(d => d.Job).WithMany(p => p.Labours)
                .OnDelete(DeleteBehavior.ClientSetNull)
                .HasConstraintName("FK_LaboursJobs_JobId");
        });

        modelBuilder.Entity<Supply>(entity =>
        {
            entity.HasKey(e => e.SupplyId).HasName("PK_Supplies_SupplyId");

            entity.HasOne(d => d.Job).WithMany(p => p.Supplies)
                .OnDelete(DeleteBehavior.ClientSetNull)
                .HasConstraintName("FK_SuppliesJobs_JobId");
        });

        OnModelCreatingPartial(modelBuilder);
    }

    partial void OnModelCreatingPartial(ModelBuilder modelBuilder);
}


================================================================================
FILE: RenoSystem\ENTITIES\Client.cs
================================================================================
// <auto-generated> This file has been auto generated by EF Core Power Tools. </auto-generated>
#nullable disable
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using Microsoft.EntityFrameworkCore;

namespace RenoSystem.ENTITIES;

public partial class Client
{
    [Key]
    public int ClientId { get; set; }

    [Required]
    [StringLength(50)]
    public string Contact { get; set; }

    [Required]
    [StringLength(10)]
    public string Phone { get; set; }

    [Required]
    [StringLength(8)]
    public string Number { get; set; }

    [StringLength(5)]
    public string Unit { get; set; }

    [Required]
    [StringLength(25)]
    public string Street { get; set; }

    [Required]
    [StringLength(25)]
    public string City { get; set; }

    [Required]
    [StringLength(2)]
    [Unicode(false)]
    public string Province { get; set; }

    [Required]
    [StringLength(6)]
    [Unicode(false)]
    public string PostalCode { get; set; }

    [InverseProperty("Client")]
    public virtual ICollection<Job> Jobs { get; set; } = new List<Job>();
}


================================================================================
FILE: RenoSystem\ENTITIES\Job.cs
================================================================================
// <auto-generated> This file has been auto generated by EF Core Power Tools. </auto-generated>
#nullable disable
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using Microsoft.EntityFrameworkCore;

namespace RenoSystem.ENTITIES;

public partial class Job
{
    [Key]
    public int JobId { get; set; }

    public int ClientId { get; set; }

    [Required]
    [StringLength(500)]
    public string Description { get; set; }

    [Column(TypeName = "datetime")]
    public DateTime StartDate { get; set; }

    [Column(TypeName = "datetime")]
    public DateTime CompletionDate { get; set; }

    [Required]
    [StringLength(12)]
    public string PlanId { get; set; }

    [ForeignKey("ClientId")]
    [InverseProperty("Jobs")]
    public virtual Client Client { get; set; }

    [InverseProperty("Job")]
    public virtual ICollection<Labour> Labours { get; set; } = new List<Labour>();

    [InverseProperty("Job")]
    public virtual ICollection<Supply> Supplies { get; set; } = new List<Supply>();
}


================================================================================
FILE: RenoSystem\ENTITIES\Supply.cs
================================================================================
// <auto-generated> This file has been auto generated by EF Core Power Tools. </auto-generated>
#nullable disable
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using Microsoft.EntityFrameworkCore;

namespace RenoSystem.ENTITIES;

public partial class Supply
{
    [Key]
    public int SupplyId { get; set; }

    public int JobId { get; set; }

    [Required]
    [StringLength(100)]
    public string Material { get; set; }

    public int Quantity { get; set; }

    [Column(TypeName = "money")]
    public decimal MaterialCost { get; set; }

    [ForeignKey("JobId")]
    [InverseProperty("Supplies")]
    public virtual Job Job { get; set; }
}


================================================================================
FILE: RenoSystem\ENTITIES\Labour.cs
================================================================================
// <auto-generated> This file has been auto generated by EF Core Power Tools. </auto-generated>
#nullable disable
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using Microsoft.EntityFrameworkCore;

namespace RenoSystem.ENTITIES;

public partial class Labour
{
    [Key]
    public int LabourId { get; set; }

    public int JobId { get; set; }

    [Required]
    [StringLength(100)]
    public string Description { get; set; }

    public double Hours { get; set; }

    [Column(TypeName = "money")]
    public decimal LabourCost { get; set; }

    [Column(TypeName = "datetime")]
    public DateTime ScheduleDate { get; set; }

    [ForeignKey("JobId")]
    [InverseProperty("Labours")]
    public virtual Job Job { get; set; }
}


================================================================================
FILE: RenoSystem\ENTITIES\DbVersion.cs
================================================================================
// <auto-generated> This file has been auto generated by EF Core Power Tools. </auto-generated>
#nullable disable
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using Microsoft.EntityFrameworkCore;

namespace RenoSystem.ENTITIES;

[Table("DbVersion")]
public partial class DbVersion
{
    [Key]
    public int Id { get; set; }

    public int Major { get; set; }

    public int Minor { get; set; }

    public int Build { get; set; }

    [Column(TypeName = "datetime")]
    public DateTime ReleaseDate { get; set; }
}


================================================================================
SUMMARY OF CURRENT STATE
================================================================================

WHAT'S COMPLETED:
-----------------
Project Structure:
  - Solution: RenoDBSolution created
  - Web Application: RenoTracker (Blazor .NET 9.0) created
  - Class Library: RenoSystem (.NET 9.0) created
  - Folder structure: BLL, DAL, ENTITIES folders exist

Database & Entities:
  - Database reverse engineering completed
  - All entity classes created with proper data annotations:
    * Client.cs
    * Job.cs
    * Supply.cs
    * Labour.cs
    * DbVersion.cs
  - RenosContext.cs created in DAL folder with internal access modifier
  - All DbSet properties configured
  - Relationships properly configured with foreign keys

Configuration:
  - appsettings.json has connection string configured (RenoDB)
  - Connection string properly formatted with encrypt=false parameter

BLL Services:
  - RenoSystemExtensions.cs created with proper static extension method
  - JobServices.cs implemented:
    * Internal constructor with RenosContext parameter
    * Job_GetList() method implemented with:
      - Include for Client navigation property
      - OrderBy Description
      - Returns IEnumerable<Job>
  - SupplyServices.cs implemented:
    * Internal constructor with RenosContext parameter
    * GetByJobId(int, int, int) method with:
      - Parameter validation (jobId > 0)
      - Paging logic (Skip/Take)
      - OrderBy Material
      - Returns List<Supply>
    * GetJobSupplyCount(int) method implemented
  - Both services registered in RenoSystemExtensions via AddTransient

Web Application:
  - Default Blazor template pages exist (Home, Weather)
  - NavMenu.razor has basic navigation structure
  - Default layout components in place


WHAT'S MISSING / INCOMPLETE:
-----------------------------
Critical Issues:
  - Program.cs is NOT properly configured:
    * Currently using AddDbContext<DbVersion> instead of calling the extension method
    * Missing call to RenosSystemExtensionServices extension method
    * Project reference to RenoSystem may not be configured
    * Missing "using RenoSystem;" statement

  - Query.razor page DOES NOT EXIST:
    * Main requirement of the assignment not implemented
    * No dropdown list for job selection
    * No search/clear buttons
    * No paging implementation
    * No table display for supplies
    * No error handling/validation messages

  - NavMenu.razor missing:
    * "Query" navigation link

  - Home.razor NOT customized:
    * Still has default "Hello, world!" content
    * Missing student name
    * Missing known bugs section
    * Missing last date modified
    * Missing credits/attributions if using external images

Optional/Nice-to-have:
  - Blazor.Bootstrap NuGet package may not be installed
  - No custom styling or branding beyond default template


WHAT NEEDS TO BE DONE NEXT:
----------------------------
Priority 1 (Critical - Required for Assignment):
  1. Fix Program.cs:
     - Remove the incorrect DbContext<DbVersion> registration
     - Add proper using statement for RenoSystem
     - Call builder.Services.RenosSystemExtensionServices() with connection string
     - Add .AddInteractiveServerComponents() for Blazor interactivity

  2. Create Query.razor page:
     - Add @page "/query" directive
     - Inject JobServices and SupplyServices
     - Create dropdown list populated with jobs (formatted as per spec)
     - Implement Search button with event handler
     - Implement Clear button with event handler
     - Create HTML table with Material, Quantity, MaterialCost columns
     - Implement paging (10 records per page)
     - Add error handling and validation messages
     - Display message when no supplies found

  3. Update NavMenu.razor:
     - Add navigation link for Query page

Priority 2 (Important - Required for Full Marks):
  4. Customize Home.razor:
     - Add student name
     - Add known bugs section
     - Add last date modified
     - Add credits/attributions if applicable
     - Improve formatting/design

Priority 3 (Good Practice):
  5. Install Blazor.Bootstrap NuGet package (if not already installed)
  6. Test the application thoroughly
  7. Handle edge cases and error scenarios
  8. Ensure code quality and readability
  9. Git commits showing incremental development


ESTIMATED COMPLETION STATUS: ~50%
----------------------------------
The foundation is solid with all entities, services, and database configuration
complete. However, the main deliverable (Query.razor page) is completely missing,
and Program.cs has a critical configuration error that will prevent the application
from working correctly.

Key files that need immediate attention:
  1. Program.cs (critical bug fix)
  2. Query.razor (completely missing - main requirement)
  3. NavMenu.razor (add Query link)
  4. Home.razor (customization required)

================================================================================
END OF DOCUMENT
================================================================================
